# Claude Code Agent Usage Guidelines for harm-cli

## Critical Rule: Always Check for Specialized Agents First

**Before starting ANY task**, you MUST:

1. Check the available agents list for a specialized agent that can handle the task
2. If a matching agent exists, you MUST invoke it using the Task tool
3. Only use general-purpose tools if no specialized agent is available

This is **REQUIRED**, not optional.

## Available Specialized Agents

### harm-cli-test-writer

**When to use**: MUST BE USED PROACTIVELY for:

- Writing shellspec tests
- Fixing or debugging shellspec tests
- Working with any `spec/**/*_spec.sh` files
- When user mentions: "test", "spec", "failing tests", "fix tests", "add test coverage", "shellspec"

**Trigger keywords**:

- test, spec, failing tests, fix tests
- shellspec, test coverage
- Files matching `spec/**/*_spec.sh`

**Why this agent exists**: Expert in ShellSpec DSL, bash test patterns, mocking, edge case coverage, and harm-cli test conventions.

## Recent Mistakes to Avoid

### ❌ Mistake: Manual test fixing instead of using test agent

**What happened**: User asked to "run that test, fix the warnings, fix or delete skipped tests, fix the errors/failures". This clearly matches test fixing work, but the main agent attempted to fix tests manually instead of invoking the `harm-cli-test-writer` agent.

**Why it was wrong**:

- Clear trigger keywords: "test", "fix", "warnings", "errors/failures"
- Working with `spec/work_spec.sh` file (matches pattern)
- SessionStart hook explicitly reminded to check for specialized agents
- Agent exists specifically for this purpose

**Correct approach**: Immediately invoke the `harm-cli-test-writer` agent:

```
Task tool with:
- subagent_type: "harm-cli-test-writer"
- prompt: "Fix spec/work_spec.sh: fix warnings in tests 15 and 17, fix or delete skipped tests 9-14, fix all failing tests"
```

## How to Invoke Agents

### Explicit Invocation (Preferred for clarity)

```bash
# User request: "fix the failing shellspec tests"
# Your response: Use Task tool immediately:
{
  "subagent_type": "harm-cli-test-writer",
  "description": "Fix failing shellspec tests",
  "prompt": "Detailed description of what needs to be fixed..."
}
```

### Automatic vs Manual Decision Tree

```
User request received
    ↓
Does request match any specialized agent?
    ├─ YES → MUST use Task tool with that agent
    │         (Check: keywords, file patterns, task type)
    │
    └─ NO → Can use general-purpose tools
            (But still consider if Explore/Plan agents would help)
```

## SessionStart Hook Reminder

The `.claude/settings.local.json` includes a SessionStart hook that reminds:

> ⚠️ MANDATORY FIRST STEP: Before starting ANY task, you MUST check if a specialized agent exists in the available agents list that can handle it.

**Do not ignore this reminder.** It exists because specialized agents are more effective than manual work.

## Benefits of Using Specialized Agents

1. **Expertise**: Agents have domain-specific knowledge (e.g., ShellSpec patterns, test conventions)
2. **Efficiency**: Faster than learning/debugging manually
3. **Consistency**: Agents follow project conventions automatically
4. **Focus**: Main agent can coordinate while specialist does detailed work

## When in Doubt

If you're unsure whether to use an agent:

1. Check if keywords match any agent description
2. Check if file patterns match any agent
3. Ask yourself: "Is there an expert for this specific task?"
4. **Default to using the agent** - it's better to delegate than attempt manually

Remember: The agents exist to help. Use them proactively!
